{% extends "base.html" %}
{% load i18n %}

{% block headtags %}
<script type="text/javascript" src="/media/js/procedures.js"></script>
<link rel="stylesheet" type="text/css" href="/media/css/procedures.css" />
{% endblock %}

{% block page %}

<div class="block">
	<div class="block_head">
		<div class="bheadl"></div>
		<div class="bheadr"></div>
		<h2>{{title}}</h2>
	</div>
    <div class="block_content">
		<h2 class="floatleft">{% trans "File sets" %}</h2>
		&nbsp;&nbsp;<a href="/filesets/add/" class="css3button positive edit-fileset" id="fileset_new">{% trans "Add" %}</a>
		<select class="computer-fileset" id="select_fileset_new">
			<option value="">{% trans "from computer" %}</option>
            {% for computer in computers %}
            <option value="{{ computer.id }}">{{ computer.name }}</option>
            {% endfor %}
        </select>
		
		<div class="clear"></div><hr />
		<!-- real env for filesets -->
		<div class="procedure">
            {% for fileset in filesets %}
			<div class="fileset">
                <div class="title" id="fileset_{{ fileset.id }}">
                    <div class="title-left">
    			        <span class="name">{{ fileset.name }}</span>
                    </div>
                    <div class="title-right">
						<select class="computer-fileset" id="select_fileset_{{fileset.id}}">
							<option value="">{% trans "Choose a computer::" %}</option>
                            {% for computer in computers %}
                            <option value="{{ computer.id }}">{{ computer.name }}</option>
                            {% endfor %}
                        </select>
                        <a class="css3button positive edit-fileset" id="fileset_{{fileset.id}}" href="/filesets/{{ fileset.id }}/edit/"><span>{% trans "Edit" %}</span></a>
                        <a class="css3button negative" href="/filesets/delete/{{fileset.id}}"><span>{% trans "Remove" %}</span></a>
                    </div>
                    <div class="clear"></div>
                </div><!-- .title -->
                <div class="body">
                    <div class="left">
                        <h3>{% trans "Used by:" %}</h3>
                        <table cellpadding="0" cellspacing="0">
                            <thead>
                                <tr><th>{% trans "Procedure" %}</th><th>{% trans "Computer" %}</th></tr>
                            </thead>
                            <tbody>
                                {% for procedure in fileset.procedures.all %}
                                <tr><td>{{procedure.name}}</td><td>{{procedure.computer}}</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div><!-- .left -->
                    <div class="right">
                        <h3 class="floatleft">{% trans "List of files" %}</h3>
                        <div class="clear"></div>
                        <div class="list">
                        <ul>
                            {% for file in fileset.files.all %}
                            <li>{{file.path}}</li>
                            {% endfor %}
							{% if fileset.includes %}
							{% trans "Since only those patterns below:" %}<br/>
                            {% for wildcard in fileset.includes %}
                            <li>{{wildcard.expression}}</li>
                            {% endfor %}
							{% endif %}
							{% if fileset.excludes %}
							{% trans "With the exception of those in the standards below:" %}<br/>
                            {% for wildcard in fileset.excludes %}
                            <li>{{wildcard.expression}}</li>
                            {% endfor %}
							{% endif %}
                        </ul>
                        </div>
                    </div><!-- .right -->
                    <div class="clear"></div>
                </div><!-- .body -->
			</div><!-- .fileset -->
			<hr />
			{% endfor %}
		</div><!-- .procedure -->
        
        <h2 class="floatleft">{% trans "Schedules" %}</h2>&nbsp;<a href="/schedules/add/" class="css3button positive edit-schedule"><span>{% trans "Add" %}</span></a>
		<div class="clear"></div><hr />
        <!-- real env for schedules -->
		<div class="schedule">
            {% for schedule in schedules %}
			<div class="fileset">
                <div class="title">
                    <div class="title-left">
    			        <span class="name">{{ schedule.name }}</span>
                    </div>
                    <div class="title-right">
                        <a class="css3button positive edit-schedule" href="/schedules/{{schedule.id}}/edit/"><span>{% trans "Edit" %}</span></a>
                        <a class="css3button negative" href="/schedules/delete/{{schedule.id}}"><span>{% trans "Remove" %}</span></a>
                    </div>
                    <div class="clear"></div>
                </div><!-- .title -->
                <div class="body">
                    <div class="left">
                        <h3>{% trans "Used by:" %}</h3>
                        <table cellpadding="0" cellspacing="0">
                            <thead>
                                <tr><th>{% trans "Procedure" %}</th><th>{% trans "Computer" %}</th></tr>
                            </thead>
                            <tbody>
            					{% for procedure in schedule.procedures.all %}
            					<tr><td>{{procedure.name}}</td><td>{{procedure.computer}}</td></tr>
            					{% endfor %}
            				</tbody>
                        </table>
                    </div><!-- .left -->
                    <div class="right">
                        <h3 class="floatleft">{% trans "Schedules" %}</h3>
                        <div class="clear"></div>
						<div class="list">
                        <table cellpadding="0" cellspacing="0">
                            <thead>
                                <tr><th>{% trans "Type" %}</th><th>{% trans "Frequency" %}</th><th>{% trans "Day" %}</th><th>{% trans "Time" %}</th></tr>
                            </thead>
                            <tbody>
            					{% for run in schedule.runs.all %}
								<tr><th>{{run.level}}</th><th>{{run.kind.name_pt}}</th><th>{{run.day_string}}</th><th>{{run.hour}}:{{run.minute}}</th></tr>
            					{% endfor %}
            				</tbody>
                        </table>
						</div>
                    </div><!-- .right -->
                    <div class="clear"></div>
                </div><!-- .body -->
			</div><!-- .fileset -->
			<hr />
            {% endfor %}
		</div><!-- .schedule -->
		<div class="clear"></div><hr />
    </div>
    <div class="bendl"></div>
	<div class="bendr"></div>

</div>

{% endblock %}
